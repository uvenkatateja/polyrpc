# PolyRPC

> The Invisible Bridge between Python Backends and TypeScript Frontends.

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![CI](https://github.com/uvenkatateja/polyrpc/actions/workflows/ci.yml/badge.svg)](https://github.com/uvenkatateja/polyrpc/actions/workflows/ci.yml)
[![crates.io](https://img.shields.io/crates/v/polyrpc-sentinel.svg)](https://crates.io/crates/polyrpc-sentinel)
[![npm](https://img.shields.io/npm/v/polyrpc.svg)](https://www.npmjs.com/package/polyrpc)
[![Documentation](https://img.shields.io/badge/docs-polyrpc.vercel.app-blue)](https://polyrpc.vercel.app)

PolyRPC provides **real-time type inference** from Python (FastAPI/Pydantic) to TypeScript, giving you the "tRPC experience" without abandoning Python.

**[ğŸ“š Documentation](https://polyrpc.vercel.app)** | **[ğŸš€ Getting Started](https://polyrpc.vercel.app/docs/getting-started)** | **[ğŸ’¡ Examples](./examples)**

## The Problem

In 2026, the world is split between **Python** (AI/ML, FastAPI) and **TypeScript** (React, Next.js). Connecting them is painful:

- **Manual**: Write Python model â†’ Write TypeScript interface â†’ Human error, out-of-sync bugs
- **Code Gen**: Write Python â†’ Run `npm run generate` â†’ Wait 5 seconds â†’ Restart â†’ Flow broken
- **tRPC**: Magic! But... TypeScript-only backend

## The Solution

PolyRPC gives you tRPC-like magic while keeping your Python backend:

```
You save server.py â†’ Rust parses AST in <50ms â†’ TypeScript types update â†’ VS Code autocomplete works
```

**No commands. No build steps. Just save and code.**

## Quick Start

```bash
# Install CLI (includes Rust binary)
npm install -g polyrpc
# or: cargo install polyrpc-sentinel

# Initialize in your project
polyrpc init

# Generate types once
polyrpc generate

# Or watch for changes (real-time)
polyrpc watch
```

## The Generated Client

PolyRPC generates a **self-contained, type-safe client** with a tRPC-like pattern:

```typescript
// polyrpc.ts - Auto-generated, zero dependencies
import { py, User, UserRole } from './polyrpc';

// Queries (GET requests)
const users = await py.users.get_users.query();
const user = await py.users.get_user.query({ user_id: 1 });

// Mutations (POST/PUT/DELETE)
const newUser = await py.users.create_user.mutate({
  name: "John",
  email: "john@example.com",
  role: UserRole.ADMIN,  // Enums work!
});

await py.users.delete_user.mutate({ user_id: 1 });
```

### What Gets Generated

From this Python code:

```python
from pydantic import BaseModel
from enum import Enum
from fastapi import FastAPI

app = FastAPI()

class UserRole(Enum):
    ADMIN = "admin"
    USER = "user"

class User(BaseModel):
    id: int
    name: str
    email: str
    role: UserRole = UserRole.USER

class CreateUserRequest(BaseModel):
    name: str
    email: str

@app.get("/users")
def get_users() -> list[User]:
    return []

@app.post("/users")
def create_user(data: CreateUserRequest) -> User:
    return User(id=1, name=data.name, email=data.email)
```

PolyRPC generates:

```typescript
// polyrpc.ts - Auto-generated by PolyRPC

export enum UserRole {
  ADMIN = "admin",
  USER = "user",
}

export interface User {
  id: number;
  name: string;
  email: string;
  role?: UserRole;
}

export interface CreateUserRequest {
  name: string;
  email: string;
}

export const py = {
  users: {
    get_users: {
      query: () => request<User[]>('GET', '/users'),
    },
    create_user: {
      mutate: (input: CreateUserRequest) => request<User>('POST', '/users', input),
    },
  },
} as const;
```

## Features

- âœ… **Zero Runtime Dependencies** - Generated client is self-contained
- âœ… **tRPC-like Pattern** - `.query()` and `.mutate()` methods
- âœ… **Full Type Safety** - Autocomplete for all routes and models
- âœ… **Enums as Values** - Use `UserRole.ADMIN` directly
- âœ… **Path Parameters** - `py.users.get_user.query({ user_id: 1 })`
- âœ… **Request Body Detection** - Automatically typed from Pydantic models
- âœ… **Tree-Shakeable** - Unused routes removed by bundler
- âœ… **<50ms Generation** - Instant feedback on save

## Configuration

Create `polyrpc.toml` in your project root:

```toml
[python]
source_dir = "./backend"
include = ["**/*.py"]
exclude = ["__pycache__", "**/test_*.py"]

[typescript]
output_file = "./frontend/src/polyrpc.ts"

[api]
base_url = "http://localhost:8000"
```

## Type Mapping

| Python | TypeScript |
|--------|------------|
| `str` | `string` |
| `int`, `float` | `number` |
| `bool` | `boolean` |
| `List[T]` | `T[]` |
| `Dict[K, V]` | `Record<K, V>` |
| `Optional[T]` | `T \| null` |
| `Union[A, B]` | `A \| B` |
| `Literal["a", "b"]` | `"a" \| "b"` |
| `Enum` | TypeScript `enum` |

## Packages

| Package | Description | Install |
|---------|-------------|---------|
| `polyrpc-sentinel` | Rust binary (core) | `cargo install polyrpc-sentinel` |
| `polyrpc` | CLI wrapper | `npm i -g polyrpc` |
| `@polyrpc/client` | Optional fetch utilities | `npm i @polyrpc/client` |
| `@polyrpc/react` | React Query hooks | `npm i @polyrpc/react` |

## How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python Files   â”‚â”€â”€â”€â”€â–¶â”‚  Rust Sentinel   â”‚â”€â”€â”€â”€â–¶â”‚  polyrpc.ts     â”‚
â”‚  (Pydantic)     â”‚     â”‚  (tree-sitter)   â”‚     â”‚  (Type-safe)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                        â”‚
   You save file          <50ms parse              Full autocomplete
   (Ctrl+S)               No Python runtime        in your IDE
```

## Why Rust?

Python parsing Python is slow. We need <50ms response times to feel "instant". Rust + tree-sitter gives us:

- **Speed**: Parse entire codebase in milliseconds
- **No Runtime**: Static analysis, no Python interpreter needed
- **Incremental**: Only re-parse changed files
- **Cross-platform**: Single binary for Windows/Mac/Linux

## Development

```bash
# Clone the repo
git clone https://github.com/uvenkatateja/polyrpc
cd polyrpc

# Install dependencies
pnpm install

# Build Rust binary
cd crates/sentinel
cargo build --release

# Run tests
cargo test
```

## License

MIT

---

**[ğŸ“š Full Documentation](https://polyrpc.vercel.app)** | **[GitHub](https://github.com/uvenkatateja/polyrpc)**
